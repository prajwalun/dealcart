# Reverse proxy for DealCart+ UI and API
:80 {
    # Health check endpoint for Docker
    route /caddy-health {
        respond 200
    }
    
    # API routes go to edge-gateway
    route /api/* {
        reverse_proxy edge-gateway:8080
    }
    
    # Actuator health check
    route /actuator/* {
        reverse_proxy edge-gateway:8080
    }
    
    # All other routes (UI) go to Next.js app
    reverse_proxy web-ui:3000
    
    # Enable logging
    log {
        output stdout
        format json
    }
    
    # Add server header
    header Server "DealCart+"
    
    # CORS headers
    header Access-Control-Allow-Origin *
    header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    header Access-Control-Allow-Headers *
}

